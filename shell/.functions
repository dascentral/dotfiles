# Commit everything
function commit() {
    commitMessage="$1"

    if [ "$commitMessage" = "" ]; then
        commitMessage="WIP"
    fi

    git add .
    eval "git commit -a -m '${commitMessage}'"
}

# Commit everything and push
function commitp() {
    commitMessage="$1"

    if [ "$commitMessage" = "" ]; then
        commitMessage="WIP"
    fi

    git add .
    eval "git commit -a -m '${commitMessage}'"
    git hf push
}

# Create a new MySQL database
# DEPRECATED — Switching to bash script
#function createdb() {
#    if [ $# != 1 ]; then
#        echo "Usage: createdb [dbname]";
#    else
#        mysql -u root -e "CREATE DATABASE $1 CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci"
#    fi
#}

# Create a new directory and enter it
function mkd() {
    mkdir -p "$@" && cd "$@"
}

# Output Laravel routes in an abbreviated format
# DEPRECATED — Switching to bash script
#function routes() {
#    if [ ! -e "artisan" ]; then
#        printf "\033[1;33mYou are not in the root of a Laravel application.\033[0m\n"
#    fi
#
#    if [ -e "artisan" ]; then
#      if [ $# != 1 ]; then
#          php artisan route:list --columns=method,uri,name
#      else
#          php artisan route:list --columns=method,uri,name --name=$1
#      fi
#    fi
#}

# Finish the current HubFlow feature
function ff() {
  parts=(`echo $(git symbolic-ref -q HEAD) | tr '/' ' '`)

  if [ $parts[3] != 'feature' ]; then
    printf "\033[1;33mYou do not appear to be within a feature branch.\033[0m\n"
  else
    git hf feature finish ${parts[4]}
  fi
}

# cat the latest Laravel log
function cll() {
  if [ ! -e "artisan" ]; then
      printf "\033[1;33mYou are not in the root of a Laravel application.\033[0m\n"
  fi

  if [ -e "artisan" ] && [ ! -e "storage/logs" ]; then
      printf "\033[1;33mThere is no "storage/logs" folder.\033[0m\n"
  fi

  if [ -e "artisan" ] && [ -e "storage/logs" ]; then
    file=(`ls -Art storage/logs | tail -n 1`)
    cat storage/logs/$file
  fi
}

# tail the latest Laravel log
function tll() {
  if [ ! -e "artisan" ]; then
      printf "\033[1;33mYou are not in the root of a Laravel application.\033[0m\n"
  fi

  if [ -e "artisan" ] && [ ! -e "storage/logs" ]; then
      printf "\033[1;33mThere is no "storage/logs" folder.\033[0m\n"
  fi

  if [ -e "artisan" ] && [ -e "storage/logs" ]; then
    file=(`ls -Art storage/logs | tail -n 1`)
    tail -f storage/logs/$file
  fi
}

# switch PHP versions
# Credit: https://freek.dev/1185-easily-switch-php-versions-in-laravel-valet
phpv() {
  valet stop
  brew unlink php@7.3 php@7.4
  brew link --force --overwrite $1
  brew services start $1
  composer global update
  rm -f ~/.config/valet/valet.sock
  valet install
}

# check if this repo has been inited for hubflow
#hubflow_has_master_configured() {
#        local master=$(git config --get hubflow.branch.master)
#        [ "$master" != "" ] && git_local_branch_exists "$master"
#}
#
#hubflow_has_develop_configured() {
#        local develop=$(git config --get hubflow.branch.develop)
#        [ "$develop" != "" ] && git_local_branch_exists "$develop"
#}
#
#hubflow_has_prefixes_configured() {
#        git config --get hubflow.prefix.feature >/dev/null 2>&1     && \
#        git config --get hubflow.prefix.release >/dev/null 2>&1     && \
#        git config --get hubflow.prefix.hotfix >/dev/null 2>&1      && \
#        git config --get hubflow.prefix.support >/dev/null 2>&1     && \
#        git config --get hubflow.prefix.versiontag >/dev/null 2>&1
#}
#
#hubflow_is_initialized() {
#        hubflow_has_master_configured                    && \
#        hubflow_has_develop_configured                   && \
#        [ "$(git config --get hubflow.branch.master)" !=    \
#          "$(git config --get hubflow.branch.develop)" ] && \
#        hubflow_has_prefixes_configured
#}
